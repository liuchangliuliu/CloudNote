<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>无道云笔记</title>
    <link rel="stylesheet" href="bootstrap-3.3.7-dist/css/bootstrap.css">
    <script src="jquery/jquery-1.11.3.min.js" type="javascript"></script>
    <script src="bootstrap-3.3.7-dist/js/bootstrap.min.js" type="javascript"></script>
    <script src="http://cdn.bootcss.com/wangeditor/2.1.20/js/lib/jquery-2.2.1.js"></script>

    <style>
        *{
            margin: 0;
            padding: 0;
        }
        #left .panel-body a{
            text-decoration: none;
            text-align: center;
        }

        #left .panel-body a:hover{
            color: #2aabd2;
        }
        .wjj_div{
            margin-left: 10px;
        }
    </style>
</head>
<body style="padding: 50px;">
    <nav class="navbar navbar-inverse navbar-fixed-top" style="height: 50px;">

        <div class="container-fluid">
            <!--无道云的图标-->
            <div class="navbar-header">
                <a class="navbar-brand" href="#">
                    <img alt="Brand" src="...">
                </a>
            </div>

            <!--设置-->
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a style="background: none" href="#" class="dropdown-toggle" data-toggle="dropdown" >
                        设置 <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li id="msg" ><a href="#">个人信息</a></li>
                        <li class="divider"></li>
                        <li id="account"><a href="#">账户设置</a></li>
                        <li class="divider"></li>
                        <li id="share" ><a href="#">查看分享</a></li>
                        <li class="divider"></li>
                        <li id="help" ><a href="#">帮助</a></li>


                    </ul>
                </li>
            </ul>
                <!--头像-->
            <div class=" navbar-right" style="margin-right: 30px;">
                <img src="cinqueterre.jpg" class="img-responsive" alt="Cinque Terre">
            </div>
            <!--搜索-->
            <div>
                <form class="navbar-form navbar-left" role="search">
                    <div class="form-group">
                        <input type="text" class="form-control" style="border:none; background:none;outline:none;" placeholder="Search" />
                    </div>
                    <button type="submit" class="btn btn-default">查找</button>
                </form>
                </button>
            </div>
        </div>


    </nav>

    <div id="left" style="background-color: #fbfcfe;width:200px;float: left;height: 500px;" >
        <div class="wjj">
            <a class="btn js_wjj_btn">我的文件夹</a>
            <div class="wjj_div">
                <div class="wjj">
                    <a class="btn js_wjj_btn">文件夹1</a>
                    <div class="wjj_div" >
                        <div class="wjj">
                            <a class="btn js_wjj_btn">文件夹1-1</a>
                            <div class="wjj_div">

                            </div>
                        </div>
                    </div>
                </div>

                <div class="wjj">
                    <a class="btn js_wjj_btn">文件夹1</a>
                    <div class="wjj_div" >
                        <div class="wjj">
                            <a class="btn js_wjj_btn">文件夹1-1</a>
                            <div class="wjj_div">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/jquery.contextify.js"></script>
    <script>
        /*一些全局变量*/
        //当前点击的目录
        var $chooseDir = null;
        var options = {items:[
            // {header: ''},
            {text: '新建目录', onclick: createDir},
            {text: '新建笔记', onclick: function() {alert("你点击了第二个链接")}},
            // {divider: true}
        ]}
        var dirTPL = '' +
            '              <div class="wjj">\n' +
            '                    <input type="text" name="dir_name" value="新建文件夹">' +
            '                    <div class="wjj_div" >\n' +
            '                    </div>\n' +
            '                </div>';

        $(".js_wjj_btn").bind("contextmenu", function(){
            //记录右键点击的元素
            $chooseDir = $(this);
            var $brother = $chooseDir.next();
            $brother.removeClass("hidden");

        });
        function createDir() {
            /*$('#myModal').modal('show');*/
            var $brother = $chooseDir.next();
            $brother.append(dirTPL);
            $('input[name=dir_name]').select();
            initUI();
        }

        function initUI() {
            /*失去焦点事件*/
            $('input[name=dir_name]').blur(function(){
                //获取名字
                var name = $('input[name=dir_name]').val();
                //把文本框删掉
                var $parent = $('input[name=dir_name]').parent();
                $('input[name=dir_name]').remove();
                //生成目录
                $parent.prepend('<a class="btn js_wjj_btn" >'+name+'</a>');
                initUI();
                //发送给服务器
                $.ajax({
                    type:'post',
                    url:'/creatDir',
                    async:false,
                    dataType:'json',
                    data:{
                        'type':dirName,
                        'dirName':name
                    },
                    success:function(msg){
                        if (!msg.res){
                            alert("文件夹创建失败!");
                            return false;
                        }
                        return true;
                    },
                    error:function (error) {
                        alert("出错!");
                    }
                });
            })
            $('.js_wjj_btn').contextify(options);
            $('.js_wjj_btn').on("click",function () {
                var $this = $(this);
                var $parent = $this.parent();
                var $brother = $parent.find('.wjj_div');
                if ($brother.hasClass("hidden")){
                    $brother.removeClass("hidden");
                }else {
                    $brother.addClass("hidden");
                }
            });
        }

        initUI();

    </script>



    <div id="wangeditor" style="width:800px;float: right; height: 600px;" >
        <div style="max-width:700px;margin:50px;height: 700px;">
            <div id="txtdiv" style="border:1px solid gray;min-height:400px">

            </div>
        </div>


        <!--脚本控制-->
        <script src="js/jquery.contextify.js"></script>
        <script>
            $(function(){
                //初始化编辑器
                editor = new wangEditor("txtdiv");
                editor.create();

                //内容修改事件，此处做的是实时展示实际效果
                editor.onchange = function(){
                    //获取editor的html值
                    var html = editor.$txt.html();
                    $("#show_box").html(html)
                }
            })

        </script>

        <!--按照官网上的说明，js和css的这两个引用应该放在body的末尾-->
        <script src="http://cdn.bootcss.com/wangeditor/2.1.20/js/wangEditor.js"></script>
        <link href="http://cdn.bootcss.com/wangeditor/2.1.20/css/wangEditor.css" rel="stylesheet">
    </div>



</body>
</html>